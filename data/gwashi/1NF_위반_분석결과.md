# 데이터베이스 제1정규형(1NF) 위반 분석 결과

**분석 일자**: 2025-10-30
**분석 대상**: data/gwashi/raw.xlsx
**총 시트 수**: 16개

---

## 요약

과시(科試) 데이터베이스의 ID 체계가 **제1정규형(First Normal Form, 1NF)을 심각하게 위반**하고 있습니다.

### 핵심 문제

1. **동일 ID가 서로 다른 엔티티를 지칭** - 가장 치명적
2. **미상(未詳) 정보의 단일 ID 처리** - 구분 불가능
3. **참조 무결성 위반** - 엣지 정보의 타겟 모호성

---

## 1. Exam ID 중복 문제 (CRITICAL)

### 발견된 문제
- **13개의 중복 Exam ID** 발견
- **9개 ID가 서로 다른 시험을 지칭** (참조 무결성 위반)

### 구체적 사례

#### 사례 1: E17770000BF2 (3회 중복)
```
동일 ID가 3개의 서로 다른 시험을 가리킴:
1. 1777년_증광시대과_중장
2. 1777년_식년시대과
3. 1777년_정시대과
```

**문제점**:
- 증광시, 식년시, 정시는 **완전히 다른 시험**
- 중장은 특정 단계를 의미
- 이 ID로 연결된 엣지는 **어떤 시험을 가리키는지 알 수 없음**

#### 사례 2: E15071009B (2회 중복)
```
1. 1507년_식년시대과
2. 1507년_중시대과
```

**문제점**:
- 식년시와 중시는 **별개의 시험 제도**
- 식년시: 정기 시험 (3년마다)
- 중시: 급제자 재시험
- 동일 날짜에 두 시험이 열렸을 가능성 없음

#### 사례 3: E17170801BT (2회 중복)
```
1. 1717년_함경도별시대과
2. 1717년_평안도별시대과
```

**문제점**:
- 지역이 다른 별도 시험 (함경도 vs 평안도)
- 장소, 응시자, 결과가 완전히 다름
- **지리적으로 구분되어야 할 엔티티가 동일 ID로 통합됨**

#### 사례 4: E17230000BS1 (2회 중복)
```
1. 1723년_증광시대과_초장
2. 1723년_식년시대과_초장
```

**문제점**:
- 증광시 ≠ 식년시 (시험 성격이 다름)
- 두 시험의 초장(초시)은 **별개의 이벤트**
- 응시자, 문제, 결과 모두 다름

---

## 2. Time ID 중복 문제

### 발견된 문제
- **209개의 중복 Time ID** 발견
- 연도만 있는 ID가 과도하게 재사용됨

### 구체적 사례

#### 최다 중복: "1689년" (9회 사용)
```
동일한 "1689년" ID가 9개의 서로 다른 시점을 나타냄
→ 월/일 정보가 없는 경우 연도만으로 ID 생성
→ 한 해에 여러 시험이 있을 경우 구분 불가
```

#### "00" 패턴 (미상 날짜)
```
발견된 미상 날짜 ID: 7개
- 1498년0000
- 1508년0000
- 1537년0000
- 1563년0000
- 1569년0000
- 1583년0000
- 1584년0000
```

**문제점**:
- "0000"이 월일 미상을 의미
- 하지만 이들은 **서로 다른 시점**이어야 함
- 예: 1498년0000 != 1508년0000 (당연히 다른 시점)
- 그러나 동일 연도 내 미상 월일은 **구분 불가능**

---

## 3. 제1정규형 위반의 정의와 비교

### 제1정규형(1NF) 요구사항

1. **원자성(Atomicity)**: 각 속성은 원자값만 가져야 함
2. **고유 식별(Unique Identification)**: 각 행은 고유하게 식별 가능해야 함
3. **반복 그룹 금지**: 다중값 속성 불가

### 본 데이터베이스의 위반 사항

| 요구사항 | 현재 상태 | 위반 여부 |
|---------|----------|----------|
| 원자성 | ID가 복합 정보 인코딩 (연도+시험종류+단계) | **위반** |
| 고유 식별 | 동일 ID가 서로 다른 엔티티 지칭 | **심각한 위반** |
| 반복 그룹 금지 | 미상 정보를 단일 ID로 통합 | **위반** |

---

## 4. 온톨로지 및 데이터 처리에 미치는 영향

### 4.1 데이터 의미론(Semantics) 문제

#### SPO 트리플 예시
```
잘못된 경우:
Subject: Person_A
Predicate: 응시하다(tookExam)
Object: E17770000BF2

문제: E17770000BF2가 가리키는 것이 무엇인가?
→ 1777년_증광시대과_중장?
→ 1777년_식년시대과?
→ 1777년_정시대과?

결과: 추론 불가능, 지식 그래프 손상
```

#### SPARQL 쿼리 오류
```sparql
# "1777년 식년시를 본 사람은?"
SELECT ?person WHERE {
  ?person :tookExam :E17770000BF2 .
}

# 결과: 증광시, 식년시, 정시 응시자가 모두 섞여서 반환됨
# → 데이터 무결성 0%
```

### 4.2 질의 효율(Query Efficiency) 문제

#### JOIN 연산 오류
```sql
-- Exam과 Time을 JOIN하여 시험 일자 조회
SELECT e.exam_name, t.date
FROM Exam e
JOIN Time t ON e.time_id = t.time_id
WHERE e.exam_id = 'E17170801BT'

결과:
함경도별시대과, 1717년08월01일
평안도별시대과, 1717년08월01일

문제: 두 시험이 동일한 날짜로 잘못 연결됨
→ 실제로는 다른 날짜에 열렸을 가능성 높음
```

### 4.3 원자성(Atomicity) 위반

#### ID 인코딩 문제
```
E17770000BF2의 구조:
E      - 접두사 (Exam)
1777   - 연도
0000   - 월일 (미상)
BF2    - 시험종류 및 단계 코드

문제:
1. "0000"이 미상을 의미하는지, 실제 날짜인지 불명확
2. "BF2"의 의미가 일관적이지 않음
   - 때로는 "중장"
   - 때로는 "식년시대과"
   - 때로는 "정시대과"
```

### 4.4 논리적 일관성(Logical Consistency) 파괴

```
명제 1: Person_A가 E17770000BF2 시험을 응시했다
명제 2: E17770000BF2는 1777년_식년시대과이다
명제 3: E17770000BF2는 1777년_증광시대과_중장이다
명제 4: E17770000BF2는 1777년_정시대과이다

논리적 모순:
명제 2, 3, 4는 상호 배타적
→ Person_A가 동시에 3개의 다른 시험을 봤다는 불가능한 추론
→ 온톨로지의 consistency checking 실패
```

---

## 5. 벤치마크 태스크별 영향도

### 높은 영향 (재설계 필수)

#### Retrieval 태스크
- **영향도**: ★★★★★ (치명적)
- **문제**: 엔티티 매칭이 근본적으로 잘못됨
- **예시**:
  ```
  질문: "1777년 식년시 문제는?"
  검색 결과: E17770000BF2로 연결
  실제 반환: 증광시/식년시/정시 문제가 뒤섞임
  정답률: 신뢰 불가
  ```

#### NLI (자연어 추론) 태스크
- **영향도**: ★★★★☆ (심각)
- **문제**: 추론 근거가 부정확
- **예시**:
  ```
  전제: "Person_A는 1777년 식년시에 급제했다"
  가설: "Person_A는 E17770000BF2 시험에 합격했다"

  판단: Entailment로 나와야 하나,
  실제로는 E17770000BF2가 어떤 시험인지 불명확
  → 논리적 일관성 검증 불가
  ```

### 중간 영향 (재검증 필요)

#### Punctuation 태스크
- **영향도**: ★★★☆☆ (중간)
- **문제**: 문제 텍스트 자체는 정확할 수 있으나, 메타데이터(시험 정보)가 부정확
- **예시**: 시험 맥락 정보가 잘못 연결되어 있을 가능성

### 낮은 영향 (상대적으로 안전)

#### Classification 태스크
- **영향도**: ★★☆☆☆ (낮음)
- **이유**: 텍스트 자체의 스타일 분류에 집중, 엔티티 관계 덜 중요
- **단**: 여전히 메타데이터 오류 가능성

#### Translation 태스크
- **영향도**: ★☆☆☆☆ (매우 낮음)
- **이유**: 번역 품질은 엔티티 ID와 무관
- **단**: 원문 출처 검증 시 문제 가능

---

## 6. 올바른 설계 방안

### 6.1 ID 체계 재설계

#### 현재 (잘못된 방식)
```
E17770000BF2
→ 동일 ID가 3개의 다른 시험을 가리킴
```

#### 수정안 1: UUID 방식
```
Exam 1: E_UUID_a7f3c21d-4b8e-4a1f-9d2c-8f6e5b3a1c0d
Exam 2: E_UUID_b8e4d32e-5c9f-5b2g-0e3d-9g7f6c4b2d1e
Exam 3: E_UUID_c9f5e43f-6d0g-6c3h-1f4e-0h8g7d5c3e2f
```

**장점**:
- 절대 중복 없음
- 전역적으로 고유(globally unique)

**단점**:
- 가독성 낮음
- 데이터 의미 파악 어려움

#### 수정안 2: 구조화된 고유 ID (권장)
```
1777년_증광시대과_중장:
  → E_1777_JeungGwang_MiddleStage_001

1777년_식년시대과:
  → E_1777_SikNyeon_Final_001

1777년_정시대과:
  → E_1777_JeongSi_Final_001

1717년_함경도별시대과:
  → E_1717_0801_HamGyeongDo_ByeolSi_001

1717년_평안도별시대과:
  → E_1717_0801_PyeongAnDo_ByeolSi_001
```

**구조**:
```
E_[연도]_[시험종류]_[단계]_[일련번호]
```

**장점**:
- 고유성 보장
- 의미 파악 가능
- 확장 가능 (일련번호로 동일 조건 구분)

### 6.2 미상(未詳) 정보 처리

#### 현재 (잘못된 방식)
```
생년 미상인 사람들:
  Person A: birthdate = "미상"
  Person B: birthdate = "미상"
  Person C: birthdate = "미상"

→ 검색 시 "미상"으로 모두 묶임
→ A, B, C가 같은 생년인 것처럼 오인
```

#### 수정안: NULL 값 또는 별도 컬럼
```
방법 1: NULL 사용
Person A: birthdate = NULL, birthdate_unknown = TRUE
Person B: birthdate = NULL, birthdate_unknown = TRUE

방법 2: 특수값 + 고유 ID
Person A: birthdate = UNKNOWN, person_id = P0004
Person B: birthdate = UNKNOWN, person_id = P0005

→ 각 Person은 고유 ID로 구분됨
→ "미상" 여부는 별도 필드로 표시
```

### 6.3 Time 엔티티 재설계

#### 현재 (잘못된 방식)
```
T13990000 → 1399년00월00일
→ 1399년에 일어난 모든 "날짜 미상" 이벤트가 동일 ID
```

#### 수정안: 연결 테이블 분리
```
Time 테이블:
  T_1399_01_01 → 1399년 01월 01일
  T_1399_05_03 → 1399년 05월 03일

Time_Unknown 테이블:
  TU_1399_001 → 1399년 중 어느 시점 (event 1)
  TU_1399_002 → 1399년 중 어느 시점 (event 2)

Exam-Time 연결:
  E13990000SSS → TU_1399_001
  E13990000SLS → TU_1399_002
```

**장점**:
- 미상 날짜를 가진 이벤트를 개별적으로 구분
- 추후 정확한 날짜 발견 시 Time 테이블로 이전 가능

---

## 7. 미팅 발표용 핵심 포인트

### 30초 요약
"데이터베이스 ID 체계가 제1정규형을 위반하여, **동일한 ID가 서로 다른 엔티티**를 가리키고 있습니다. 특히 Exam ID 13개가 중복되며, 9개는 완전히 다른 시험을 지칭합니다. 이로 인해 Retrieval, NLI 태스크의 결과를 신뢰할 수 없습니다."

### 2분 설명
1. **문제**: 13개 Exam ID 중복, 9개가 서로 다른 시험 지칭
2. **예시**: E17770000BF2 = 증광시 OR 식년시 OR 정시 (구분 불가)
3. **영향**:
   - SPO 트리플에서 Object가 모호함
   - SPARQL 쿼리 결과 혼재
   - Retrieval/NLI 태스크 신뢰도 0
4. **해결**: ID 재설계 (UUID 또는 구조화된 고유 ID)

### 시각 자료 제안
```
[슬라이드 1: 문제 사례]
E17770000BF2 → ?
├─ 1777년_증광시대과_중장
├─ 1777년_식년시대과
└─ 1777년_정시대과

[슬라이드 2: 올바른 설계]
E_1777_JeungGwang_001 → 1777년_증광시대과_중장
E_1777_SikNyeon_001    → 1777년_식년시대과
E_1777_JeongSi_001     → 1777년_정시대과
```

---

## 8. 후속 조치 권장 사항

### 단기 (1-2주)
1. ✅ 중복 ID 전수 조사 완료
2. ⬜ 각 중복 ID에 대한 올바른 매핑 수립
3. ⬜ 새로운 ID 체계 설계 문서 작성

### 중기 (1개월)
1. ⬜ Exam, Time, Person 엔티티 ID 재할당
2. ⬜ 모든 Edge 테이블 업데이트
3. ⬜ 데이터 마이그레이션 스크립트 작성 및 검증

### 장기 (2-3개월)
1. ⬜ 벤치마크 재생성 (특히 Retrieval, NLI)
2. ⬜ 전문가 평가 재수행
3. ⬜ 논문 Method 섹션에 데이터 품질 개선 내용 추가

---

## 부록: 발견된 모든 중복 ID

### Exam ID 중복 (13개)
```
1. E17770000BF2: 3회 (증광시/식년시/정시)
2. E14960408B: 2회 (동일 시험)
3. E15071009B: 2회 (식년시/중시)
4. E17170801BT: 2회 (함경도/평안도)
5. E17230000BS1: 2회 (증광시/식년시)
6. E17350000BF2: 2회 (식년시/증광시)
7. E17350000BS3: 2회 (식년시/증광시)
8. E17741003B: 2회 (평안도/함경도)
9. E17760000BF2: 2회 (별시/정시)
10. E17770000BS: 2회 (증광시/식년시)
11. E17820000BF2: 2회 (정시/식년시)
12. E17900000BF3: 2회 (동일 시험)
13. E18071004BT: 2회 (동일 시험)
```

### Time ID 중복 (상위 30개)
```
1689년: 9회
1651년: 8회
1624년: 7회
1633년: 7회
1660년: 7회
1669년: 7회
1675년: 7회
1679년: 7회
... (총 209개)
```

---

**결론**: 데이터베이스의 근본적인 재설계 없이는 벤치마크의 학술적 신뢰성을 보장할 수 없습니다.
